// NOTE: This passage is easier to read in NotePad
// because certain lines are extremely long

// JsonObject that lists all rules
// it is required that all function look like
// function name(){...}
// if there are comments that belong to the function
// please locate them inside of the function

// beware, the validate part of the rule can be tricky
// when entering it into this list
// I have created a StringFlattener class for this purpose
// look at StringFlattener.java for details on what is required
// for the rules processor to be able to successfully process
// a validation string

// there is a problem with processing the print statement
// that contains quoted strings (e.g. print("\"a\":\"b\"))
// because there are already backslashes in these statements
// and i would have to differentiate these backslashed quotes
// from quotes that were not before but are now backslashed
// to be entered in as a validation

RuleList = {Rules:[
	{
	rule_id:"7",
	wcag_code:"1.3.1",
	sect508_code:"22.a",
	param:tags,
	validate:
		function (tags)
		{
			// function definition that checks a table for summary
			function tablerulecheckSummaryexists(table)
			{
				var contains = false;
				var pass_fail = new Object();
				for(item in table)
				{
					if(item.toLowerCase() == "summary")
					{
						contains = true;
					}
				}
				if(!contains)
				{
					pass_fail.passed = "false";
					pass_fail.message = "this table does not contain the summary attribute";
				}
				else
				{
					pass_fail.passed = "true";
					pass_fail.message = "this table does contain the summary attribute, please make sure the summary is an accurate description of the table";
				}
				return pass_fail;
			}
	
			// function definition that traverses the tags
			function tableruletraversal(tags)
			{
				// checks to see that tables have a summary attribute
				// standard traversal (either an array or object list or string)
				if(tags.constructor == Array)
				{
					for(var i=0;i<tags.length;i++)
					{
						tableruletraversal(tags[i]);
					}
				}
				// base case
				else if(tags.constructor == String)
				{
				}
				else
				{
					for(item in tags)
					{
						var val = tags[item];
						if(item.toLowerCase() == "table")
						{
							// Since json compresses xml,
							// multiple tables in one document,
							// may be compressed into an array
							if(val.constructor == Array)
							{
								for(var k=0;k<val.length;k++)
									result.test_results.push(tablerulecheckSummaryexists(val[k]));
							}
							else
								result.test_results.push(tablerulecheckSummaryexists(val));
						}
						else
							tableruletraversal(val);
					}
				}
			}

			// variable local to function to store all the results
			var result = new Object();
			result.rule_id = "7";
			result.wcag_code = "1.3.1";
			result.sect508_code = "22.a";
			result.test_results = new Array();

			// function call to begin rule validation
			tableruletraversal(tags);

			return result;
		},
	pass_message:"this table contains the summary attribute, please make sure the summary is an accurate description of the table",
	fail_message:"this table does not contain the summary attribute",
	title:"Data tables must use summary attribute."
	},
	{
	rule_id:"8",
	wcag_code:"1.3.1",
	sect508_code:"22.g",
	param:tags,
	validate:
		function (tags)
		{
			// checks if the th tag exists
			function tablerulecheckTHexists(table)
			{
				var pass_fail = new Object();
				var contains = false;
				for(item in table)
				{
					if(item.toLowerCase() == "th")
						contains = true;
				}

				if(!contains)
				{
					pass_fail.passed = "false";
					pass_fail.message = "this table's first row does not consist of th tags";
				}
				else
				{
					pass_fail.passed = "true";
					pass_fail.message = "this table does contain th tags, make sure that the first row accurately describes the columns below";
				}
				return pass_fail;
			}
	
			// function definition that traverses the tags
			function tableruletraversal(tags)
			{
				// checks to see that tables have th tags
				// standard traversal (either an array or object list or string)
				if(tags.constructor == Array)
				{
					for(var i=0;i<tags.length;i++)
					{
						tableruletraversal(tags[i]);
					}
				}
				// base case
				else if(tags.constructor == String)
				{
				}
				else
				{
					for(item in tags)
					{
						var val = tags[item];
						if(item.toLowerCase() == "table")
						{
							// Since json compresses xml,
							// multiple tables in one document,
							// may be compressed into an array
							if(val.constructor == Array)
							{
								for(var k=0;k<val.length;k++)
									result.test_results.push(tablerulecheckTHexists(val[k]));
							}
							else
								result.test_results.push(tablerulecheckTHexists(val));
						}
						else
							tableruletraversal(val);
					}
				}
			}

			// variable local to function to store all the results
			var result = new Object();
			result.rule_id = "8";
			result.wcag_code = "1.3.1";
			result.sect508_code = "22.g";
			result.test_results = new Array();

			// function call to begin rule validation
			tableruletraversal(tags);

			return result;
		},
	pass_message:"this table does contain th tags, make sure that the first row accurately describes the columns below",
	fail_message:"this table's first row does not consist of th tags",
	title:"Data tables must use th elements"
	},
	{
	rule_id:"9",
	wcag_code:"1.3.1",
	sect508_code:"22.a",
	param:tags,
	validate:
		function (tags)
		{
			// checks if the th tag exists
			function tablerulecheckSummaryAttributeNonEmpty(table)
			{
				var pass_fail = new Object();
				var nonEmpty = false;
				for(item in table)
				{
					
					if(item.toLowerCase() == "summary")
					{
						var val = table[item];
						if(val != null && val.length > 0)
							nonEmpty = true;
					}
				}

				if(!nonEmpty)
				{
					pass_fail.passed = "false";
					pass_fail.message = "a summary attribute is empty";
				}
				else
				{
					pass_fail.passed = "true";
					pass_fail.message = "summary attributes are non empty, please check to make sure that the description accurately describes the table";
				}
				return pass_fail;
			}
	
			// function definition that traverses the tags
			function tableruletraversal(tags)
			{
				// checks to see that tables have th tags
				// standard traversal (either an array or object list or string)
				if(tags.constructor == Array)
				{
					for(var i=0;i<tags.length;i++)
					{
						tableruletraversal(tags[i]);
					}
				}
				// base case
				else if(tags.constructor == String)
				{
				}
				else
				{
					for(item in tags)
					{
						var val = tags[item];
						if(item.toLowerCase() == "table")
						{
							// Since json compresses xml,
							// multiple tables in one document,
							// may be compressed into an array
							if(val.constructor == Array)
							{
								for(var k=0;k<val.length;k++)
									result.test_results.push(tablerulecheckSummaryAttributeNonEmpty(val[k]));
							}
							else
								result.test_results.push(tablerulecheckSummaryAttributeNonEmpty(val));
						}
						else
							tableruletraversal(val);
					}
				}
			}

			// variable local to function to store all the results
			var result = new Object();
			result.rule_id = "9";
			result.wcag_code = "1.3.1";
			result.sect508_code = "22.a";
			result.test_results = new Array();

			// function call to begin rule validation
			tableruletraversal(tags);

			return result;
		},
	pass_message:"summary attributes are non empty, please check to make sure that the description accurately describes the table",
	fail_message:"a summary attribute is empty",
	title:"Summary attribute content must be unique."
	},
	{
	rule_id:"14",
	wcag_code:"1.3.2",
	sect508_code:"22.h",
	param:tags,
	validate:
		function (tags)
		{
			// checks if tables contain nested tables
			function tablerulecheckForNestedTable(tableOrInside)
			{
				// traverse the table and look for another table
				// standard traversal (either an array or object list or string)
				if(tableOrInside.constructor == Array)
				{
					for(var i=0;i<tableOrInside.length;i++)
					{
						tableSeen = tableSeen || tablerulecheckForNestedTable(tableOrInside[i]);
					}
					return tableSeen;
				}
				// base case
				else if(tableOrInside.constructor == String)
				{
					return false;
				}
				else
				{
					var tableSeen = false;
					for(item in tableOrInside)
					{
						var val = tableOrInside[item];
						if(item.toLowerCase() == "table")
						{
							return true;
						}
						else
						{
							tableSeen = tableSeen || tablerulecheckForNestedTable(val);
						}
					}
					return tableSeen;
				}
			}
	
			// function definition that traverses the tags
			function tableruletraversal(tags)
			{
				// standard traversal (either an array or object list or string)
				if(tags.constructor == Array)
				{
					for(var i=0;i<tags.length;i++)
					{
						tableruletraversal(tags[i]);
					}
				}
				// base case
				else if(tags.constructor == String)
				{
				}
				else
				{
					for(item in tags)
					{
						var val = tags[item];
						if(item.toLowerCase() == "table")
						{
							// Since json compresses xml,
							// multiple tables in one document,
							// may be compressed into an array
							if(val.constructor == Array)
							{
								for(var k=0;k<val.length;k++)
								{
									var tableSeen = false;
									tableSeen = tablerulecheckForNestedTable(val[k]);

									var pass_fail = new Object();

									if(tableSeen)
									{
										pass_fail.passed = "false";
										pass_fail.message = "a table does contain nested tables, please do not use nested tables for positioning";
									}
									else
									{
										pass_fail.passed = "true";
										pass_fail.message = "tables do not contain nested tables";
									}
									result.test_results.push(pass_fail);
								}
							}
							else
							{
								var tableSeen = false;
								tableSeen = tablerulecheckForNestedTable(val);

								var pass_fail = new Object();

								if(tableSeen)
								{
									pass_fail.passed = "false";
									pass_fail.message = "a table does contain nested tables, please do not use nested tables for positioning";
								}
								else
								{
									pass_fail.passed = "true";
									pass_fail.message = "tables do not contain nested tables";
								}
								result.test_results.push(pass_fail);
							}
						}
						else
							tableruletraversal(val);
					}
				}
			}

			// variable local to function to store all the results
			var result = new Object();
			result.rule_id = "14";
			result.wcag_code = "1.3.2";
			result.sect508_code = "22.h";
			result.test_results = new Array();

			// function call to begin rule validation
			tableruletraversal(tags);

			return result;
		},
	pass_message:"tables do not contain nested tables",
	fail_message:"a table does contain nested tables, please do not use nested tables for positioning",
	title:"Do not use nested tables for positioning."
	}
]};

// all the code after this is required to call all validations
// in the rules list and then push the output onto a results
// list

// setup the results list
var resultsList = new Array();

// populate the results list
for(var i = 0; i < RuleList.Rules.length; i++)
{
	// call the rule and store in rule result
	var ruleResult = RuleList.Rules[i].validate(RuleList.Rules[i].param);
	resultsList.push(ruleResult);
}

print("Results:[\n");
for(var i = 0; i < resultsList.length; i++)
{
	print("	{\n");
	print("	rule_id:" + resultsList[i].rule_id + ",\n");
	print("	test_results:[\n");

	var rule_results = resultsList[i].test_results;
	
	for(var j = 0; j < rule_results.length; j++)
	{
		print("		{\n");
		print("		passed:" + rule_results[j].passed + "\n");
		print("		message:" + rule_results[j].message + "\n");
		print("		}\n");
		if(j != rule_results.length - 1)
			print(",\n");
	}
	print("	],\n");
	print("	wcag_code:" + resultsList[i].wcag_code + ",\n");
	print("	sect508_code:" + resultsList[i].sect508_code + "\n");
	print("	}");
	if(i != resultsList.length - 1)
		print(",\n");
	else
		print("\n");
}
print("]\n");